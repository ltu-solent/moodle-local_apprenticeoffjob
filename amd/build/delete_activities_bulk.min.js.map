{"version":3,"file":"delete_activities_bulk.min.js","sources":["../src/delete_activities_bulk.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Bulk delete activities with a Modal confirm dialogue.\n *\n * @module     local_apprenticeoffjob/delete_activities_bulk\n * @copyright  2024 Southampton Solent University {@link https://www.solent.ac.uk}\n * @author Mark sharp <mark.sharp@solent.ac.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {prefetchStrings} from 'core/prefetch';\nimport {getList} from 'core/normalise';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\nimport Ajax from 'core/ajax';\nimport Url from 'core/url';\n\nconst selectors = {\n    activeRows: 'input.activitycheckbox:checked',\n    bulkActions: '#apprentice_activitiesbulkactions',\n    table: '#apprentice_useractivities_table',\n};\n\nexport const init = () => {\n    prefetchStrings('local_apprenticeoffjob', [\n        'confirmdelete',\n        'deletewarning',\n    ]);\n    prefetchStrings('core', [\n        'delete',\n    ]);\n    registerEventListeners();\n};\n\n/**\n * Register event listeners for bulk deleting\n */\nconst registerEventListeners = () => {\n    document.querySelector(selectors.bulkActions)?.addEventListener('change', e => {\n        const action = e.target;\n        if (action.value.indexOf('#') !== -1) {\n            e.preventDefault();\n            if (action.value == '#deleteselect') {\n                deleteActivitiesConfirm();\n            }\n        }\n    });\n};\n\n/**\n * Confirm delete activities dialogue.\n */\nconst deleteActivitiesConfirm = () => {\n    const table = document.querySelector(selectors.table);\n    const fullname = table.getAttribute('data-fullname');\n    const userId = table.getAttribute('data-userid');\n    const activeRows = getList(table.querySelectorAll(selectors.activeRows));\n    const ids = activeRows.map(item => item.value);\n\n    Notification.saveCancelPromise(\n        getString('confirmdelete', 'local_apprenticeoffjob'),\n        getString('deletewarning', 'local_apprenticeoffjob', {n: ids.length, who: fullname}),\n        getString('delete', 'core'),\n    ).then(() => {\n        return deleteActivities(ids, userId);\n    }).catch(() => {\n        return;\n    });\n};\n\n/**\n * Delete activities\n *\n * @param {Number[]} ids Activity IDs\n * @param {Number} userId\n */\nasync function deleteActivities(ids, userId) {\n    const request = {\n        methodname: 'local_apprenticeoffjob_delete_activities',\n        args: {\n            activityids: ids,\n        }\n    };\n    try {\n        await Ajax.call([request])[0];\n        window.location.href = Url.relativeUrl(\n            'local/apprenticeoffjob/user.php',\n            {\n                userid: userId,\n            },\n            false\n        );\n    } catch (error) {\n        Notification.exception(error);\n    }\n}\n"],"names":["selectors","registerEventListeners","document","querySelector","addEventListener","e","action","target","value","indexOf","preventDefault","deleteActivitiesConfirm","table","fullname","getAttribute","userId","ids","querySelectorAll","map","item","saveCancelPromise","n","length","who","then","request","methodname","args","activityids","Ajax","call","window","location","href","Url","relativeUrl","userid","error","exception","deleteActivities","catch"],"mappings":";;;;;;;;kNA+BMA,qBACU,iCADVA,sBAEW,oCAFXA,gBAGK,iDAGS,mCACA,yBAA0B,CACtC,gBACA,gDAEY,OAAQ,CACpB,WAEJC,gCAMEA,uBAAyB,6DAC3BC,SAASC,cAAcH,+EAAwBI,iBAAiB,UAAUC,UAChEC,OAASD,EAAEE,QACkB,IAA/BD,OAAOE,MAAMC,QAAQ,OACrBJ,EAAEK,iBACkB,iBAAhBJ,OAAOE,OACPG,+BASVA,wBAA0B,WACtBC,MAAQV,SAASC,cAAcH,iBAC/Ba,SAAWD,MAAME,aAAa,iBAC9BC,OAASH,MAAME,aAAa,eAE5BE,KADa,sBAAQJ,MAAMK,iBAAiBjB,uBAC3BkB,KAAIC,MAAQA,KAAKX,8BAE3BY,mBACT,mBAAU,gBAAiB,2BAC3B,mBAAU,gBAAiB,yBAA0B,CAACC,EAAGL,IAAIM,OAAQC,IAAKV,YAC1E,mBAAU,SAAU,SACtBW,MAAK,mBAaqBR,IAAKD,cAC3BU,QAAU,CACZC,WAAY,2CACZC,KAAM,CACFC,YAAaZ,gBAIXa,cAAKC,KAAK,CAACL,UAAU,GAC3BM,OAAOC,SAASC,KAAOC,aAAIC,YACvB,kCACA,CACIC,OAAQrB,SAEZ,GAEN,MAAOsB,6BACQC,UAAUD,QA7BhBE,CAAiBvB,IAAKD,UAC9ByB,OAAM"}